# ÔøΩÔøΩ SoundChain Development Handoff - Claude Code Integration

**Date:** November 16, 2025  
**Status:** Marketplace Loading (200) | Auth Pages Down (500)  
**Next Phase:** Claude Code + soundchain-agentIDE Integration

---

## ‚úÖ COMPLETED WORK

### TypeScript & React Fixes
- ‚úÖ Resolved 300+ TypeScript errors
- ‚úÖ Fixed HeadlessUI v2 migration issues
- ‚úÖ Installed react-toastify
- ‚úÖ Created enum files (Genre, SaleType, SortOrder, ReactionType)

### Database & Backend
- ‚úÖ MongoDB connection working
- ‚úÖ Mongoose version conflicts resolved
- ‚úÖ API running on localhost:4000

### Pages Status
- ‚úÖ `/marketplace` - 200 OK (WORKING!)
- ‚úÖ `/create-account` - 200 OK
- ‚ùå `/home` - 500 (Apollo SSR error)
- ‚ùå `/explore` - 500 (Apollo SSR error)
- ‚ùå `/wallet` - 500 (Apollo SSR error)

---

## üî• CRITICAL ISSUE: Webpack Module Resolution

### The Problem
GraphQL hooks generated by `@graphql-codegen` exist in `src/lib/graphql.ts` but webpack fails to resolve them in the CLIENT bundle:
```
TypeError: (0, lib_graphql_hooks__WEBPACK_IMPORTED_MODULE_0__.useMeQuery) is not a function
```

### What We Tried
1. ‚úÖ Created re-export file `src/lib/graphql-hooks.ts`
2. ‚úÖ Updated imports across codebase
3. ‚úÖ Cleared cache multiple times
4. ‚ùå Hooks still undefined in client bundle
5. ‚ùå Server-side bundle works fine (SSR functional)

### Current Workaround
Commented out mutation hooks to prevent crashes:
- `useUpdateDefaultWalletMutation` - bypassed
- `useUpdateMetaMaskAddressesMutation` - bypassed

---

## ÔøΩÔøΩ KEY FILES TO REVIEW

### GraphQL & Apollo
- `src/lib/graphql.ts` - Generated hooks (8000+ lines)
- `src/lib/graphql-hooks.ts` - Re-export wrapper
- `src/lib/apollo/index.tsx` - Apollo Client config
- `src/lib/protectPage.ts` - Auth HOC (has syntax error on line 8)

### Hooks with Issues
- `src/hooks/useMe.ts` - Using graphql-hooks
- `src/hooks/useWalletContext.tsx` - Mutation bypassed
- `src/hooks/useMetaMask.ts` - Mutation bypassed

### Working Pages
- `src/pages/marketplace.tsx` - NO auth required
- `src/pages/create-account.tsx` - Public page

### Broken Pages
- `src/pages/home.tsx` - Needs Me query
- `src/pages/explore.tsx` - Uses protectPage
- `src/pages/wallet/index.tsx` - Uses protectPage

---

## üéØ NEXT STEPS FOR CLAUDE CODE

### Phase 1: Fix Immediate Syntax Error
File: `src/lib/protectPage.ts:8`
Error: Missing `<` in generic type definition

**Fix:**
```typescript
export type GetServerSidePropsWithContext
  P extends { [key: string]: any } = { [key: string]: any },
  Q extends ParsedUrlQuery = ParsedUrlQuery
> = (
```

### Phase 2: Webpack Bundle Analysis
1. Install webpack-bundle-analyzer
2. Analyze client vs server bundles
3. Identify why GraphQL hooks are tree-shaken
4. Check module graph for circular dependencies

### Phase 3: Alternative Approaches
- **Option A:** Split graphql.ts into smaller modules
- **Option B:** Custom webpack config to preserve exports
- **Option C:** Move to SSR-only auth (bypass client hooks)
- **Option D:** Try different codegen plugins

---

## üõ†Ô∏è ENVIRONMENT SETUP
```bash
# Working Directory
cd ~/soundchain/web

# Start Dev Server
yarn dev

# Start API Server (separate terminal)
cd ~/soundchain/api
yarn dev

# MongoDB
# Atlas connection working via env vars
```

### Environment Variables
- `.env.local` - Contains API keys
- MongoDB URI configured
- Magic Link API keys present
- Pinata IPFS configured

---

## üîë TECHNICAL CONTEXT

### Tech Stack
- Next.js 14.2.33
- React 18
- TypeScript 5.x
- Apollo Client 3.10.11
- GraphQL Code Generator
- Tailwind CSS 3.3+

### Blockchain Integration
- Polygon (MATIC) - Primary chain
- ZetaChain - Omnichain functionality
- 24 cryptocurrencies supported
- Magic Link + MetaMask wallets

---

## üéµ SOUNDCHAIN FEATURES

### Current Functionality
- 8,236 NFTs on marketplace
- 700+ active users
- OGUN token economy (1 billion supply)
- Multi-chain asset support
- Music streaming via Mux
- IPFS storage via Pinata

### Vision
- Web3 Music OS
- Real-time smart contracts
- AI-powered soundchain-agentIDE
- P2P offline functionality
- Desktop/mobile apps

---

## üöÄ INTEGRATION WITH SOUNDCHAIN-AGENTIDE

The soundchain-agentIDE can:
1. Monitor webpack build process
2. Analyze bundle outputs
3. Suggest code splits
4. Auto-fix import issues
5. Generate test cases

**AgentIDE Commands:**
```bash
echo "[AgentIDE] Analyzing webpack bundles..."
echo "[AgentIDE] Checking GraphQL hook exports..."
echo "[AgentIDE] Proposing module resolution fix..."
```

---

## üìä SUCCESS METRICS

### Immediate Goals
- [ ] Fix protectPage.ts syntax error
- [ ] Resolve webpack module resolution
- [ ] Get /home, /explore, /wallet to 200 status
- [ ] Restore user authentication

### Long-term Goals
- [ ] Full omnichain marketplace functional
- [ ] Zero TypeScript errors
- [ ] All 24 tokens integrated
- [ ] Mobile app deployment ready

---

## üéØ HANDOFF CHECKLIST

- [x] Documented all completed work
- [x] Identified critical blockers
- [x] Listed all affected files
- [x] Provided environment setup
- [x] Outlined next steps
- [ ] Claude Code activated
- [ ] soundchain-agentIDE synced
- [ ] Webpack issue resolved

---

**This is where Claude in browser left off. Claude Code, take it from here!** üöÄ

The marketplace is ALIVE. Let's get the rest of the platform back online!

Web3 revolution continues... üíéüî•‚ú®
